---
title: "Async / Await" 
sidebar:
    order: 0020
---

import Figure from '@components/CustomFigure.astro';
// import domtree from '@assets/kmom04/htmldom.png';



Vi ska inte gå på djupet med Promises i den här kursen, utan vi håller det på en hög nivå. Vi såg i artikeln om Fetch API att vi kan använda `.then()` för att hamna i ett läge i koden där vi har inväntat svar från något funktionsanrop.

Vi kan antingen skapa egna så kallade "Promises", eller i vissa fall använda de som redan finns inbyggda i diverse funktionsanrop, som tex fetch(). Kortfattat så ger ett Promise ett löfte om att något kommer returneras. Det är där then() kommer in i bilden.

Vi kan göra det på ett annat sätt, med hjälp av *async/await*. Strukturen sre då ut mer som kanske är vana att programmera i. Vi kikar på ett exempel där vi ska hämta en fil:

```js
let data = await fetch(`https://url-to-a-file.json`)
let json = await data.json()

// Här har du tillgång till datan
```

Vi kan nu skriva koden på ett enligt många, behändigare sätt som är enklare att följa och strukturera, utan att fastna i någon form av callback hell: .then().then().then(). Kravet är bara att funktionen returnerar ett Promise, vilket många av de inbyggda funktionerna gör i dagsläget.

För att nyttja async kan vi skapa en egen funktion med nyckelordet `async`. För att använda await behöver vi wrappa anropet i en "async function". I skrivande stund kan man med så kallade ES moduler använda await även i den översta nivån.

```js title="async"
async function readData() {
  // Nu kan vi använda await i funktionen
  let data = await fetch(`https://url-to-a-file.json`)
  let json = await data.json()

  return json
}
```

För att sedan använda vår skapade funktion kallar vi på den med await:

```js title="await"
let parsedData = await readData()
// Här har vi tillgång till datan
```

Läs mer om [async på MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function).

Läs mer om [await på MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await).





